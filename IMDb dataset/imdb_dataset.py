# -*- coding: utf-8 -*-
"""IMDb dataset.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1IrfAfpkBR-MwQbGbLqMRvK3G_KYQDFoJ
"""

import pandas as pd
import numpy as np

#Reading csv file
df = pd.read_csv("/content/imdb_data.csv")
print(df.head().to_markdown(index=False,numalign="left",stralign="left"))
print()
#printing the shape of the dataset
print("Shape of the Dataset")
print(df.shape)
#printing the information of the data
print("Info of the dataset")
print(df.info())

"""**Questions:-**
1. Which movie made the highest profit? Who were its producer and director? Identify the actors in that film.
"""

top_revenued=df.sort_values(by='revenue',ascending=False)[:1]
top_revenued.head()

df['crew'].fillna(0,inplace=True)

def convert_to_lst(string):
    try:
        return eval(string)
    except:
        return np.nan

df['crew']=df['crew'].apply(convert_to_lst)
df['cast']=df['cast'].apply(convert_to_lst)
df['genres']=df['genres'].apply(convert_to_lst)

df1=df.copy()

df1['profit']=df1['revenue']-df1['budget']

max_profit=df1['profit'].max()

df2_max=df1[df1['profit']==max_profit].reset_index(drop=True)

df2_max['crew'][0]

for i in df2_max['crew'][0]:
    if i["job"] == "Producer" or i["job"] == "Director":
        print(f'{i["job"]}:{i["name"]}')

df2_max['cast'].iloc[0]

for i in df2_max['cast'][0]:
    if i["gender"] == 2 :
        print(f'{i["gender"]}:{i["name"]}')

"""**Question**:
1. Which film has the max ROI
"""

df1['roi']=(df1['profit']/df1['budget'])*100
df1[['profit','budget','roi']].sort_values(by='roi',ascending=False)
max_roi=df1[df1['roi']!=np.inf]['roi'].max()
df1[df1['roi']==max_roi]

"""**Question**:
1.  Find out the unique genres of movies in this dataset.
"""

df2_genre=df1[~df1['genres'].isna()].reset_index(drop=True)

df2_genre

list_genre=[]

for i in range(len(df2_genre)):
    for j in df2_genre['genres'].iloc[i]:
        print(j)
        list_genre.append(j['name'])

uniques_genres=list(set(list_genre))
pd.Series(uniques_genres)
pd.DataFrame(uniques_genres,columns=['Genres'])

"""**Make a table of all the producers and directors of each movie. Find the top 3 producers who have produced movies with the highest average RoI?**"""

df2_genre=df1[~df1['genres'].isna()].reset_index(drop=True)
df2_genre

uniques_genres=list(set(list_genre))

pd.Series(uniques_genres)

pd.DataFrame(uniques_genres,columns=['Genres'])

## code to consider only those rows of crew which are not null

df2_crew=df1[df1['crew'].notna()]

def directors_list(dict_prod):
    list_directors=[]

    for i in dict_prod:
        if i['job']=='Director':
            list_directors.append(i['name'])

    return list_directors

df2_crew['Directors']=df2_crew['crew'].apply(directors_list)

df2_crew['Directors']

"""**Which actor has acted in the most number of movies? Deep dive into the movies, genres and profits corresponding to this actor.**"""

df2_cast=df1[df1['cast'].notna()].reset_index(drop=True)

list_actors=[]
for i in range(len(df2_cast)):
    dictionary_list=df2_cast['cast'].iloc[i]
    for j in dictionary_list:
        if j['gender']==2:
            list_actors.append(j['name'])

actors_df=pd.DataFrame(list_actors)
actors_df.value_counts()[0:5]

